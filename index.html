<!DOCTYPE html>
<html>
<head>
    <title>3D RPG Кликер с прогрессией</title>
    <body>
        <div id="game-container">
            <h1>3D RPG Кликер</h1>
            
            <div class="difficulty-indicator">
                Уровень сложности: <span id="difficulty">1</span>/5
            </div>
            
            <div class="resource">Золото: <span id="gold">0</span></div>
            <div class="resource">Уровень: <span id="level">1</span></div>
            <div class="level-progress">
                <div id="level-progress" class="level-progress-fill"></div>
            </div>
            <div class="resource">Опыт: <span id="exp">0</span>/<span id="exp-needed">100</span></div>
            
            <div id="mob-container">
                <div id="mob" class="mob mob-slime"></div>
                <div class="mob-health">
                    <div id="mob-health" class="mob-health-fill"></div>
                </div>
                <div id="mob-name" class="mob-name">Слайм</div>
            </div>
            
            <div class="resource">Сила атаки: <span id="attack-power">1</span></div>
            <div class="resource">DPS: <span id="auto-power">0</span>/сек</div>
            
            <div id="combat-log"></div>
            
            <h2>Улучшения</h2>
            <div id="upgrades-container">
                <div class="upgrade-card">
                    <h3>Атака</h3>
                    <button class="upgrade" onclick="buyUpgrade('attack', 0)">
                        +1 сила (Цена: 10)
                    </button>
                    <button class="upgrade" onclick="buyUpgrade('attack', 1)">
                        +5 силы (Цена: 100)
                    </button>
                </div>
                
                <div class="upgrade-card">
                    <h3>Автоатака</h3>
                    <button class="upgrade" onclick="buyUpgrade('auto', 0)">
                        +1/сек (Цена: 50)
                    </button>
                    <button class="upgrade" onclick="buyUpgrade('auto', 1)">
                        +10/сек (Цена: 400)
                    </button>
                </div>
            </div>
            
            <h2>Навыки</h2>
            <div class="upgrade-card">
                <button id="skill-critical" class="skill" onclick="buySkill('critical')">
                    Критический удар (15%)<br>
                    Требуется: 3 уровень<br>
                    Цена: 200
                </button>
                <button id="skill-aoe" class="skill" onclick="buySkill('aoe')">
                    Удар по площади (25%)<br>
                    Требуется: 5 уровень<br>
                    Цена: 500
                </button>
                <button id="skill-life" class="skill" onclick="buySkill('life')">
                    Вампиризм (10%)<br>
                    Требуется: 7 уровень<br>
                    Цена: 800
                </button>
                <button id="skill-ultimate" class="skill" onclick="buySkill('ultimate')">
                    Ультимативная атака (5%)<br>
                    Требуется: 10 уровень<br>
                    Цена: 1500
                </button>
            </div>
            
            <button id="show-rating" class="upgrade" style="margin-top: 20px;">
                Показать глобальный рейтинг
            </button>
        </div>
    
        <div id="rating-container">
            <div id="rating-table">
                <h2>Глобальный рейтинг</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Место</th>
                            <th>Имя</th>
                            <th>Уровень</th>
                            <th>Золото</th>
                        </tr>
                    </thead>
                    <tbody id="rating-body">
                        <tr><td colspan="4">Загрузка данных...</td></tr>
                    </tbody>
                </table>
                <button id="close-rating">Закрыть</button>
            </div>
        </div>
    
        <div id="author-text">by nqrelz</div>
        <button id="about-button">Об игре</button>
    
        <script>
            // Игровые переменные
            const game = {
                playerId: null,
                playerName: '',
                gold: 0,
                level: 1,
                exp: 0,
                expNeeded: 100,
                attackPower: 1,
                autoPower: 0,
                difficulty: 1,
                skills: {
                    critical: { bought: false, levelReq: 3, cost: 200, chance: 0.15, multiplier: 2 },
                    aoe: { bought: false, levelReq: 5, cost: 500, chance: 0.25, aoeDamage: 0.5 },
                    life: { bought: false, levelReq: 7, cost: 800, chance: 0.1, healPercent: 0.3 },
                    ultimate: { bought: false, levelReq: 10, cost: 1500, chance: 0.05, multiplier: 5 }
                },
                mobs: [
                    { name: "Слайм", class: "mob-slime", baseHealth: 30, health: 30, baseReward: 5, baseExp: 10 },
                    { name: "Гоблин", class: "mob-goblin", baseHealth: 60, health: 60, baseReward: 15, baseExp: 25 },
                    { name: "Скелет", class: "mob-skeleton", baseHealth: 90, health: 90, baseReward: 25, baseExp: 40 },
                    { name: "Дракон", class: "mob-dragon", baseHealth: 150, health: 150, baseReward: 40, baseExp: 60 }
                ],
                currentMob: 0,
                upgrades: {
                    attack: [{ cost: 10, power: 1 }, { cost: 100, power: 5 }],
                    auto: [{ cost: 50, power: 1 }, { cost: 400, power: 10 }]
                },
                log: []
            };
    
            // Элементы DOM
            const elements = {
                gold: document.getElementById('gold'),
                level: document.getElementById('level'),
                exp: document.getElementById('exp'),
                expNeeded: document.getElementById('exp-needed'),
                levelProgress: document.getElementById('level-progress'),
                attackPower: document.getElementById('attack-power'),
                autoPower: document.getElementById('auto-power'),
                mob: document.getElementById('mob'),
                mobHealth: document.getElementById('mob-health'),
                mobName: document.getElementById('mob-name'),
                combatLog: document.getElementById('combat-log'),
                skillCritical: document.getElementById('skill-critical'),
                skillAoe: document.getElementById('skill-aoe'),
                skillLife: document.getElementById('skill-life'),
                skillUltimate: document.getElementById('skill-ultimate'),
                difficulty: document.getElementById('difficulty')
            };
    
            // Инициализация игры
            async function init() {
                // Загружаем данные игрока из localStorage
                const savedData = localStorage.getItem('playerData');
                if (savedData) {
                    const playerData = JSON.parse(savedData);
                    game.playerId = playerData.id;
                    game.playerName = playerData.name;
                }
                
                loadGame();
                updateDifficulty();
                spawnMob(0);
                render();
                setupFastClick();
                
                // Автоатака
                setInterval(autoAttack, 1000);
                
                // Кнопки рейтинга
                document.getElementById('show-rating').addEventListener('click', showRating);
                document.getElementById('close-rating').addEventListener('click', hideRating);
                
                // Кнопка "Об игре"
                document.getElementById('about-button').addEventListener('click', function() {
                    window.open("first.html", "_blank");
                });
            }
    
            // Остальные функции игры остаются без изменений
            // ... (все ваши существующие функции) ...
    
            // Обновленные функции для работы с рейтингом
            async function showRating() {
                const ratingContainer = document.getElementById('rating-container');
                const ratingBody = document.getElementById('rating-body');
        
                ratingContainer.style.display = 'flex';
                ratingBody.innerHTML = '<tr><td colspan="4">Загрузка данных...</td></tr>';
        
                try {
                    const response = await fetch('http://localhost:5000/api/leaderboard');
                    if (!response.ok) throw new Error('Ошибка загрузки рейтинга');
                    
                    const leaderboard = await response.json();
                    updateRatingTable(leaderboard);
                } catch (error) {
                    console.error('Ошибка загрузки рейтинга:', error);
                    ratingBody.innerHTML = '<tr><td colspan="4">Ошибка загрузки рейтинга</td></tr>';
                }
            }
    
            function hideRating() {
                document.getElementById('rating-container').style.display = 'none';
            }
    
            function updateRatingTable(leaderboard) {
                const tbody = document.getElementById('rating-body');
                tbody.innerHTML = '';
                
                // Добавляем текущего игрока, если его нет в рейтинге
                const playerInRating = leaderboard.some(p => p.id === game.playerId);
                if (!playerInRating && game.playerId) {
                    leaderboard.push({
                        id: game.playerId,
                        name: game.playerName,
                        level: game.level,
                        gold: game.gold,
                        score: game.level * 100 + game.gold,
                        rank: null
                    });
                }
                
                // Сортируем по score (уровень*100 + золото)
                leaderboard.sort((a, b) => b.score - a.score);
                
                // Ограничиваем топ-10 и добавляем ранги
                const top10 = leaderboard.slice(0, 10).map((player, index) => ({
                    ...player,
                    rank: index + 1
                }));
                
                // Заполняем таблицу
                top10.forEach(player => {
                    const row = document.createElement('tr');
                    if (player.id === game.playerId) {
                        row.style.fontWeight = 'bold';
                        row.style.color = '#f95959';
                    }
                    
                    row.innerHTML = `
                        <td>${player.rank}</td>
                        <td>${player.name}</td>
                        <td>${player.level}</td>
                        <td>${player.gold}</td>
                    `;
                    
                    tbody.appendChild(row);
                });
            }
    
            // Обновленная функция сохранения игры
            async function saveGame() {
                // Локальное сохранение
                localStorage.setItem('3dRpgClicker', JSON.stringify({
                    gold: game.gold,
                    level: game.level,
                    exp: game.exp,
                    expNeeded: game.expNeeded,
                    attackPower: game.attackPower,
                    autoPower: game.autoPower,
                    skills: game.skills,
                    difficulty: game.difficulty
                }));
                
                // Сохранение на сервер
                if (game.playerId) {
                    try {
                        await fetch('http://localhost:5000/api/update', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                id: game.playerId,
                                level: game.level,
                                gold: game.gold
                            })
                        });
                    } catch (error) {
                        console.error('Ошибка сохранения на сервер:', error);
                    }
                }
            }
    
            // Запуск игры
            init();
        </script>
   <!-- Добавьте этот код в index.html перед закрывающим тегом </body> -->
<div id="inventory-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;justify-content:center;align-items:center;">
    <div style="background:#16213e;padding:20px;border-radius:10px;width:80%;max-width:500px;">
        <h2 style="color:#f95959;">Инвентарь</h2>
        <div id="inventory-items" style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:15px 0;">
            <!-- Слоты инвентаря будут добавляться здесь -->
        </div>
        <button onclick="closeInventory()" style="background:#f95959;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;">Закрыть</button>
    </div>
</div>


    
    
</body>
</html>